# ========================================
# TeleCuidar - PRODUCTION Environment
# Ubuntu Server 24 LTS - HTTPS/SSL
# ========================================
# IMPORTANTE: Este arquivo contém configurações sensíveis
# NÃO commitar este arquivo no git
# Mantenha em local seguro e use permissões restritas:
# chmod 600 .env.prod
# ========================================

# ========================================
# GERAL
# ========================================
NODE_ENV=production
ASPNETCORE_ENVIRONMENT=Production
TZ=America/Sao_Paulo

# ========================================
# BACKEND - API
# ========================================
# URL base da API (usado pelo frontend)
API_URL=https://www.telecuidar.com.br/api

# Porta do backend (não exposta diretamente - via Nginx)
BACKEND_PORT=5239

# Porta interna do backend no Docker
BACKEND_INTERNAL_PORT=5000

# ========================================
# BANCO DE DADOS
# ========================================
# SQLite (produção - caminho absoluto no container)
DB_CONNECTION_STRING=Data Source=/app/data/telecuidar.db

# IMPORTANTE: Faça backup regular do banco de dados!
# O volume backend-data é persistente, mas backup externo é essencial

# ========================================
# JWT - AUTENTICAÇÃO
# ========================================
# CRÍTICO: GERE UMA CHAVE SECRETA FORTE E ÚNICA
# Comando: openssl rand -base64 64
# NUNCA use a chave de exemplo abaixo!
JWT_SECRET_KEY=ALTERE_ESTA_CHAVE_PARA_PRODUCAO_openssl_rand_base64_64
JWT_ISSUER=TelecuidarAPI
JWT_AUDIENCE=TelecuidarClient
JWT_EXPIRATION_MINUTES=60
JWT_REFRESH_TOKEN_EXPIRATION_DAYS=7

# ========================================
# CORS - CROSS-ORIGIN
# ========================================
# Domínios permitidos (todos redirecionam para https://www.telecuidar.com.br)
CORS_ALLOWED_ORIGINS=https://www.telecuidar.com.br,https://telecuidar.com.br,https://telecuidar.com,https://www.telecuidar.com,https://meet.telecuidar.com.br

# ========================================
# FILE STORAGE - UPLOAD DE ARQUIVOS
# ========================================
FILE_UPLOAD_PATH=/app/uploads
FILE_MAX_SIZE_MB=50
FILE_ALLOWED_EXTENSIONS=.pdf,.doc,.docx,.jpg,.jpeg,.png,.txt,.gif,.webp

# ========================================
# EMAIL - CONFIGURAÇÃO DE ENVIO
# ========================================
# IMPORTANTE: Configure com credenciais reais do servidor SMTP
EMAIL_ENABLED=true
EMAIL_SMTP_HOST=smtp.hostinger.com
EMAIL_SMTP_PORT=587
EMAIL_SMTP_USER=contato@telecuidar.com.br
EMAIL_SMTP_PASSWORD=ALTERE_PARA_SENHA_REAL_DO_EMAIL
EMAIL_FROM_NAME=TeleCuidar
EMAIL_FROM_ADDRESS=contato@telecuidar.com.br
EMAIL_USE_SSL=true

# ========================================
# FRONTEND - ANGULAR
# ========================================
FRONTEND_PORT=4200
FRONTEND_HOST=0.0.0.0
FRONTEND_URL=https://www.telecuidar.com.br

# Porta interna do frontend no Docker (SSR)
FRONTEND_INTERNAL_PORT=4000

# ========================================
# SEED DATA - DADOS INICIAIS
# ========================================
# Credenciais do primeiro admin
# ALTERE ESTAS CREDENCIAIS IMEDIATAMENTE APÓS PRIMEIRO DEPLOY!
SEED_ADMIN_EMAIL=adm@adm.com
SEED_ADMIN_PASSWORD=zxcasd122
SEED_ADMIN_NAME=Admin
SEED_ADMIN_LASTNAME=Sistema
SEED_ADMIN_CPF=00000000000

# Habilitar seed automático (desabilitar após primeiro deploy)
SEED_DATA_ENABLED=true

# ========================================
# SEGURANÇA
# ========================================
# Habilitar HTTPS redirect
ENABLE_HTTPS_REDIRECT=true

# Rate limiting (requisições por período)
RATE_LIMIT_ENABLED=true
RATE_LIMIT_REQUESTS_API=10
RATE_LIMIT_REQUESTS_GENERAL=30
RATE_LIMIT_PERIOD_SECONDS=1

# Conexões simultâneas por IP
MAX_CONNECTIONS_API=10
MAX_CONNECTIONS_GENERAL=20

# ========================================
# LOGGING
# ========================================
LOG_LEVEL=Warning
LOG_LEVEL_ASPNET=Error
LOG_TO_FILE=true
LOG_FILE_PATH=/app/logs/telecuidar.log

# ========================================
# AI - Configuração de IA
# ========================================
AI_ENABLED=true
AI_API_KEY=ALTERE_PARA_SUA_API_KEY_DEEPSEEK
AI_API_URL=https://api.deepseek.com/v1/chat/completions
AI_MODEL=deepseek-chat
AI_TIMEOUT_SECONDS=120

# ========================================
# JITSI MEET - VIDEOCHAMADA SELF-HOSTED
# ========================================
# Habilitar sistema de videochamada
JITSI_ENABLED=true

# Versão da imagem Docker do Jitsi (stable)
JITSI_IMAGE_TAG=stable-9753

# ----------------------------------------
# DOMÍNIO DO JITSI - PRODUÇÃO
# ----------------------------------------
# PRODUÇÃO: meet.telecuidar.com.br (Nginx faz proxy na porta 443)
JITSI_DOMAIN=meet.telecuidar.com.br

# URL pública do Jitsi (HTTPS na porta 443 via Nginx)
JITSI_PUBLIC_URL=https://meet.telecuidar.com.br

# ID da aplicação (deve ser igual ao configurado no Prosody JWT)
JITSI_APP_ID=telecuidar

# Chave secreta para JWT (CRÍTICO)
# IMPORTANTE: Gere uma chave forte: openssl rand -base64 64
# Esta chave DEVE ser a mesma no backend e no Prosody
JITSI_APP_SECRET=ALTERE_ESTA_CHAVE_JITSI_openssl_rand_base64_64

# Requer autenticação JWT (sempre true para produção)
JITSI_REQUIRES_AUTH=true

# Tempo de expiração do token em minutos
JITSI_TOKEN_EXPIRATION_MINUTES=120

# Desabilitar convidados (sem autenticação) - PRODUÇÃO
JITSI_ENABLE_GUESTS=0

# Habilitar autenticação obrigatória
JITSI_ENABLE_AUTH=1

# Porta do Jitsi Web (HTTPS) - exposta via Docker
JITSI_WEB_PORT=8443

# Porta UDP do JVB (Video Bridge) - DEVE ser exposta publicamente
JVB_PORT=10000

# Porta Colibri REST do JVB
JVB_COLIBRI_PORT=8080

# Servidor STUN do JVB
JVB_STUN_SERVERS=meet-jit-si-turnrelay.jitsi.net:443

# Desabilitar TCP Harvester
JVB_TCP_HARVESTER_DISABLED=true

# ========================================
# JITSI - SENHAS INTERNAS DOS COMPONENTES
# ========================================
# CRÍTICO: GERE SENHAS FORTES PARA PRODUÇÃO
# Comando: openssl rand -hex 32
# NUNCA use as senhas de exemplo abaixo!

# Senha do componente Jicofo
JICOFO_AUTH_PASSWORD=ALTERE_openssl_rand_hex_32_jicofo

# Senha do componente Jicofo (secret)
JICOFO_COMPONENT_SECRET=ALTERE_openssl_rand_hex_32_component

# Senha do JVB (Jitsi Video Bridge)
JVB_AUTH_PASSWORD=ALTERE_openssl_rand_hex_32_jvb

# ========================================
# JITSI - REDE
# ========================================
# IP público do servidor Ubuntu (OBRIGATÓRIO para produção)
# Obtenha o IP público do servidor: curl -4 ifconfig.me
# Exemplo: 203.0.113.45
DOCKER_HOST_ADDRESS=SEU_IP_PUBLICO_DO_SERVIDOR

# ========================================
# CNS - Consulta Nacional de Saúde (CADSUS)
# ========================================
# Ambiente: 'producao' ou 'hmg' (homologação)
CNS_AMBIENTE=producao

# Caminho para o certificado digital A1 (.pfx)
# Linux: /app/certs/certificado.pfx (montar volume no Docker)
CNS_CERT_PATH=/app/certs/certificado.pfx

# Senha do certificado digital
CNS_CERT_PASSWORD=ALTERE_PARA_SENHA_DO_CERTIFICADO

# ========================================
# MONITORAMENTO E ANALYTICS
# ========================================
ANALYTICS_ENABLED=false
ANALYTICS_TRACKING_ID=

# ----------------------------------------
# SENTRY - Error Tracking
# ----------------------------------------
SENTRY_ENABLED=false
SENTRY_DSN=
SENTRY_ENVIRONMENT=production
SENTRY_RELEASE=1.0.0

# ========================================
# CACHE E PERFORMANCE
# ========================================
CACHE_ENABLED=true
CACHE_EXPIRATION_MINUTES=60

# ========================================
# NGINX - PROXY REVERSO
# ========================================
# Portas expostas pelo Docker (padrão HTTP/HTTPS)
NGINX_HTTP_PORT=80
NGINX_HTTPS_PORT=443

# Domínio principal da aplicação
APP_DOMAIN=www.telecuidar.com.br

# Habilitar SSL/HTTPS
SSL_ENABLED=true

# ========================================
# SSL/TLS CERTIFICATES - Let's Encrypt
# ========================================
# Caminhos dos certificados SSL (dentro do container nginx)
# Certbot/Let's Encrypt gerará estes arquivos

# Certificado principal (www.telecuidar.com.br)
SSL_CERTIFICATE=/etc/nginx/ssl/telecuidar.crt
SSL_CERTIFICATE_KEY=/etc/nginx/ssl/telecuidar.key

# Certificado Jitsi (meet.telecuidar.com.br)
# Os arquivos devem ser nomeados: meet.fullchain.pem e meet.privkey.pem
JITSI_SSL_CERTIFICATE=/etc/nginx/ssl/meet.fullchain.pem
JITSI_SSL_CERTIFICATE_KEY=/etc/nginx/ssl/meet.privkey.pem

# ========================================
# DOCKER - CONFIGURAÇÕES
# ========================================
# Nome do projeto Docker (usado como prefixo nos containers)
COMPOSE_PROJECT_NAME=telecuidar

# Reiniciar containers automaticamente
DOCKER_RESTART_POLICY=always

# ----------------------------------------
# HEALTHCHECK - Configurações de verificação de saúde
# ----------------------------------------
HEALTHCHECK_INTERVAL=60s
HEALTHCHECK_TIMEOUT=15s
HEALTHCHECK_START_PERIOD=60s
HEALTHCHECK_RETRIES=5

# ========================================
# TESTES - CONFIGURAÇÕES
# ========================================
# URL base para testes E2E (não executar em produção)
TEST_BASE_URL=https://www.telecuidar.com.br
TEST_TIMEOUT=30000

# ========================================
# DESENVOLVIMENTO
# ========================================
# Swagger desabilitado em produção
SWAGGER_ENABLED=false

# Mock de serviços externos desabilitado
USE_MOCK_SERVICES=false

# Hot reload desabilitado
WATCH_MODE=false

# ========================================
# INSTRUÇÕES DE DEPLOY
# ========================================
#
# ╔════════════════════════════════════════════════════════════════╗
# ║  DEPLOY AUTOMÁTICO (RECOMENDADO)                               ║
# ║  Execute em uma VPS Ubuntu Server 24 LTS virgem:               ║
# ║                                                                ║
# ║  1. Clone o repositório no servidor                            ║
# ║  2. Configure o DNS antes (apontar domínios para IP do server) ║
# ║  3. Edite este arquivo (.env.prod) com suas configurações      ║
# ║  4. Execute: sudo bash deploy.sh                               ║
# ║                                                                ║
# ║  O script fará TUDO automaticamente:                           ║
# ║  ✓ Instala Docker, Docker Compose, Certbot, Fail2ban           ║
# ║  ✓ Configura firewall (UFW)                                    ║
# ║  ✓ Gera certificados SSL (Let's Encrypt)                       ║
# ║  ✓ Gera chaves secretas automaticamente                        ║
# ║  ✓ Configura backup e renovação automática de certificados     ║
# ║  ✓ Build e inicia todos os containers                          ║
# ╚════════════════════════════════════════════════════════════════╝
#
# ========================================
# DEPLOY MANUAL (alternativa)
# ========================================
# 
# 1. CERTIFICADOS SSL (Let's Encrypt)
#    Execute no servidor Ubuntu:
#    
#    sudo apt update && sudo apt install certbot python3-certbot-nginx
#    
#    # Certificado para www.telecuidar.com.br (e variações)
#    sudo certbot certonly --standalone -d telecuidar.com.br -d www.telecuidar.com.br -d telecuidar.com -d www.telecuidar.com
#    
#    # Certificado para meet.telecuidar.com.br
#    sudo certbot certonly --standalone -d meet.telecuidar.com.br
#    
#    # Copiar certificados para o diretório do projeto
#    sudo cp /etc/letsencrypt/live/telecuidar.com.br/fullchain.pem ./docker/ssl/telecuidar.crt
#    sudo cp /etc/letsencrypt/live/telecuidar.com.br/privkey.pem ./docker/ssl/telecuidar.key
#    sudo cp /etc/letsencrypt/live/meet.telecuidar.com.br/fullchain.pem ./docker/ssl/meet.fullchain.pem
#    sudo cp /etc/letsencrypt/live/meet.telecuidar.com.br/privkey.pem ./docker/ssl/meet.privkey.pem
#    sudo chmod 644 ./docker/ssl/*.pem ./docker/ssl/*.crt ./docker/ssl/*.key
#
# 2. GERAR CHAVES SECRETAS
#    
#    # JWT Secret
#    openssl rand -base64 64
#    
#    # Jitsi App Secret
#    openssl rand -base64 64
#    
#    # Jitsi Component Secrets
#    openssl rand -hex 32  # JICOFO_AUTH_PASSWORD
#    openssl rand -hex 32  # JICOFO_COMPONENT_SECRET
#    openssl rand -hex 32  # JVB_AUTH_PASSWORD
#
# 3. OBTER IP PÚBLICO DO SERVIDOR
#    
#    curl -4 ifconfig.me
#    # Anotar o IP e configurar em DOCKER_HOST_ADDRESS
#
# 4. CONFIGURAR FIREWALL (UFW)
#    
#    sudo ufw allow 80/tcp      # HTTP (redirect)
#    sudo ufw allow 443/tcp     # HTTPS
#    sudo ufw allow 10000/udp   # JVB (Jitsi Video Bridge)
#    sudo ufw allow 22/tcp      # SSH
#    sudo ufw enable
#
# 5. DNS - Configurar nos registradores de domínio
#    
#    Tipo A Records:
#    telecuidar.com.br        → SEU_IP_PUBLICO
#    www.telecuidar.com.br    → SEU_IP_PUBLICO
#    telecuidar.com           → SEU_IP_PUBLICO
#    www.telecuidar.com       → SEU_IP_PUBLICO
#    meet.telecuidar.com.br   → SEU_IP_PUBLICO
#
# 6. INICIAR APLICAÇÃO
#    
#    # Copiar .env.prod para .env
#    cp .env.prod .env
#    
#    # Editar .env e alterar todas as senhas marcadas com ALTERE
#    nano .env
#    
#    # Build e start
#    docker compose up -d --build
#    
#    # Verificar logs
#    docker compose logs -f
#
# 7. RENOVAÇÃO AUTOMÁTICA DE CERTIFICADOS
#    
#    # Adicionar ao crontab
#    sudo crontab -e
#    
#    # Adicionar linha (renovar certificados todo dia às 3h da manhã)
#    0 3 * * * certbot renew --quiet --post-hook "systemctl reload nginx"
#
# 8. BACKUP DO BANCO DE DADOS
#    
#    # Script de backup diário
#    docker exec telecuidar-backend sqlite3 /app/data/telecuidar.db ".backup '/app/data/backup-$(date +\%Y\%m\%d).db'"
#    
#    # Adicionar ao crontab para backup diário às 2h
#    0 2 * * * /caminho/para/script-backup.sh
#
# 9. MONITORAMENTO
#    
#    # Verificar saúde dos containers
#    docker compose ps
#    docker compose logs backend
#    docker compose logs frontend
#    docker compose logs jitsi-web
#    
#    # Verificar uso de recursos
#    docker stats
#
# 10. SEGURANÇA ADICIONAL
#    
#    # Permissões do arquivo .env
#    chmod 600 .env
#    
#    # Desabilitar root login SSH
#    sudo nano /etc/ssh/sshd_config
#    # PermitRootLogin no
#    sudo systemctl restart sshd
#    
#    # Instalar fail2ban
#    sudo apt install fail2ban
#    sudo systemctl enable fail2ban
#
# ========================================
